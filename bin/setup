#!/bin/sh

# Backup files
if [[ -f $HOME/.bashrc ]]; then mv $HOME/.bashrc $HOME/.bashrc.backup; fi
if [[ -f $HOME/.profile ]]; then mv $HOME/.profile $HOME/.profile.backup; fi
if [[ -f $HOME/.bash_profile ]]; then mv $HOME/.bash_profile $HOME/.bash_profile.backup; fi

# Have to install curl to install nix package manager
sudo apt install curl -y

# Install nix package manager
sh <(curl -L https://nixos.org/nix/install) --daemon --yes

# Source to get nix commands
source /etc/profile

# Remove programs on ubuntu so there are no conflicts with nix packages
sudo snap remove --purge firefox
sudo apt purge vim curl git firefox -y
sudo apt autoremove -y

# Run the nix flake configuration 
nix --extra-experimental-features 'nix-command flakes' run .#homeConfigurations."$USER".activationPackage
